cmake_minimum_required(VERSION 3.15)
project(VulkanGuide)

# 1. è®¾ç½® C++ 17 æ ‡å‡†
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# --- ğŸŒŸ å…³é”®ä¿®æ­£ï¼šå¼ºåˆ¶ MSVC ç¼–è¯‘å™¨ä½¿ç”¨ UTF-8 ---
# è¿™è¡Œä»£ç èƒ½å½»åº•è§£å†³ C4819 ä¹±ç è­¦å‘Šï¼Œä»¥åä½ åœ¨ VS Code é‡Œéšä¾¿å†™ä¸­æ–‡/æ—¥æ–‡æ³¨é‡Šéƒ½æ²¡é—®é¢˜ï¼
if(MSVC)
    add_compile_options(/utf-8)
endif()

# 2. å¯»æ‰¾ Vulkan SDK
find_package(Vulkan REQUIRED)

# 3. å¼•å…¥ vk-bootstrap
add_subdirectory(third_party/vk-bootstrap)

# 4. è®¾ç½® SDL2 è·¯å¾„
set(SDL2_PATH "${CMAKE_SOURCE_DIR}/third_party/SDL2")
include_directories(${SDL2_PATH}/include)
link_directories(${SDL2_PATH}/lib/x64)

# 5. æ‰«ææºä»£ç 
file(GLOB_RECURSE SOURCES "src/*.cpp" "src/*.h")

# 6. ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
add_executable(VulkanEngine ${SOURCES})

# 7. é“¾æ¥æ‰€æœ‰åº“
target_link_libraries(VulkanEngine
    PRIVATE 
    Vulkan::Vulkan
    vk-bootstrap
    SDL2
    SDL2main
)

# å‘Šè¯‰é¡¹ç›®æ‰€æœ‰æ–‡ä»¶å¼€å¯ GLM å®éªŒåŠŸèƒ½ (è§£å†³ GLM æŠ¥é”™)
target_compile_definitions(VulkanEngine PRIVATE GLM_ENABLE_EXPERIMENTAL)

# 8. åŒ…å«å¤´æ–‡ä»¶è·¯å¾„
target_include_directories(VulkanEngine PRIVATE 
    "${CMAKE_SOURCE_DIR}/third_party/glm"
    "${CMAKE_SOURCE_DIR}/third_party/vma"
)

# 9. (Windowsç‰¹ä¾›) è‡ªåŠ¨æ‹·è´ SDL2.dll
if(WIN32)
    add_custom_command(TARGET VulkanEngine POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_if_different
        "${SDL2_PATH}/lib/x64/SDL2.dll"
        $<TARGET_FILE_DIR:VulkanEngine>)
endif()